openapi: 3.0.3
info:
  title: Product Catalog API
  version: 1.1.0
servers:
  - url: http://localhost:3000
paths:
  /api/products:
    get:
      summary: List products
      description: Returns up to 100 products (hard cap). No pagination in this phase. Supports optional text search and category filtering.
      operationId: listProducts
      parameters:
        - in: query
          name: search
          required: false
          schema:
            type: string
          description: Case-insensitive partial substring matched against name and description (multi-word treated as a single phrase).
        - in: query
          name: categoryId
          required: false
          schema:
            type: string
          description: Filter products by category id.
      responses:
        '200':
          description: OK — array of Product (max 100 items; no pagination)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
              examples:
                sampleList:
                  summary: Sample product list response
                  value:
                    - id: "11111111-1111-4111-8111-111111111111"
                      name: "Sample Product A"
                      description: "Example A description"
                      price: 10
                      categoryId: "22222222-2222-4222-8222-222222222222"
                      stock: 5
                      imageUrl: "images/product1.jpg"
                      createdAt: "2025-11-21T00:00:00.000Z"
                      updatedAt: "2025-11-21T00:00:00.000Z"
                    - id: "33333333-3333-4333-8333-333333333333"
                      name: "Sample Product B"
                      description: "Example B description"
                      price: 3.33
                      categoryId: "22222222-2222-4222-8222-222222222222"
                      stock: 0
                      imageUrl: "images/product2.jpg"
                      createdAt: "2025-11-21T00:00:00.000Z"
                      updatedAt: "2025-11-21T00:00:00.000Z"
        '500':
          description: Server error
  /api/categories:
    get:
      summary: List categories
      operationId: listCategories
      responses:
        '200':
          description: OK — array of Category
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
              examples:
                sampleCategories:
                  summary: Sample category list
                  value:
                    - id: "22222222-2222-4222-8222-222222222222"
                      name: "Books"
                      createdAt: "2025-11-21T00:00:00.000Z"
                      updatedAt: "2025-11-21T00:00:00.000Z"
                    - id: "44444444-4444-4444-8444-444444444444"
                      name: "Electronics"
                      createdAt: "2025-11-21T00:00:00.000Z"
                      updatedAt: "2025-11-21T00:00:00.000Z"
    post:
      summary: Create category
      operationId: createCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryInput'
            examples:
              createCategory:
                summary: Create category request
                value:
                  name: "Accessories"
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
              examples:
                createdCategory:
                  summary: Created category response
                  value:
                    id: "55555555-5555-4555-8555-555555555555"
                    name: "Accessories"
                    createdAt: "2025-11-21T00:00:00.000Z"
                    updatedAt: "2025-11-21T00:00:00.000Z"
        '400':
          description: Validation error
  /api/categories/{id}:
    get:
      summary: Get category by id
      operationId: getCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
              examples:
                categoryExample:
                  summary: Single category response
                  value:
                    id: "22222222-2222-4222-8222-222222222222"
                    name: "Books"
                    createdAt: "2025-11-21T00:00:00.000Z"
                    updatedAt: "2025-11-21T00:00:00.000Z"
        '404':
          description: Not found
    put:
      summary: Update category
      operationId: updateCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryInput'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
              examples:
                updatedCategory:
                  summary: Updated category response
                  value:
                    id: "22222222-2222-4222-8222-222222222222"
                    name: "Books & Media"
                    createdAt: "2025-11-21T00:00:00.000Z"
                    updatedAt: "2025-11-21T00:05:00.000Z"
        '400':
          description: Validation error
        '404':
          description: Not found
    delete:
      summary: Delete category (blocked if products exist)
      operationId: deleteCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted
        '409':
          description: Conflict — category has assigned products
          content:
            application/json:
              examples:
                conflictDeletion:
                  summary: Blocked deletion when products reference category
                  value:
                    error: "Category has products and cannot be deleted"
        '404':
          description: Not found
  /api/orders:
    post:
      summary: Submit order
      description: Creates an order snapshot (items: productId, name, price at submission, quantity) then atomically decrements stock using conditional updates. Rejects with 409 if any item lacks sufficient stock. Total rounded once (half-up) to two decimals. Returns immutable snapshot.
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
            examples:
              sample:
                summary: Simple two-line order
                value:
                  items:
                    - productId: "11111111-1111-4111-8111-111111111111"
                      quantity: 2
                    - productId: "22222222-2222-4222-8222-222222222222"
                      quantity: 1
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
              examples:
                sample:
                  summary: Successful order response
                  value:
                    id: "b3d6e7b4-9f0c-4a11-9c1c-1d5c2d7f0abc"
                    items:
                      - productId: "11111111-1111-4111-8111-111111111111"
                        name: "Sample Product A"
                        price: 10
                        quantity: 2
                      - productId: "22222222-2222-4222-8222-222222222222"
                        name: "Sample Product B"
                        price: 3.33
                        quantity: 1
                    total: 23.33
                    status: "submitted"
                    createdAt: "2025-11-21T00:00:00.000Z"
                    updatedAt: "2025-11-21T00:00:00.000Z"
        '400':
          description: Validation error (empty cart or invalid items)
        '409':
          description: Conflict — insufficient stock for one or more items (no partial fulfillment)
  /api/orders/{id}:
    get:
      summary: Get order by id
      operationId: getOrder
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
              examples:
                orderExample:
                  summary: Retrieved order snapshot
                  value:
                    id: "b3d6e7b4-9f0c-4a11-9c1c-1d5c2d7f0abc"
                    items:
                      - productId: "11111111-1111-4111-8111-111111111111"
                        name: "Sample Product A"
                        price: 10
                        quantity: 2
                      - productId: "22222222-2222-4222-8222-222222222222"
                        name: "Sample Product B"
                        price: 3.33
                        quantity: 1
                    total: 23.33
                    status: "submitted"
                    createdAt: "2025-11-21T00:00:00.000Z"
                    updatedAt: "2025-11-21T00:00:00.000Z"
        '404':
          description: Not found
components:
  schemas:
    Product:
      type: object
      required: [id, name, description, price, stock, imageUrl, createdAt, updatedAt]
      properties:
        id:
            type: string
            format: uuid
        name:
            type: string
        description:
            type: string
        price:
            type: number
            format: double
        categoryId:
            type: string
            nullable: true
        stock:
            type: integer
            minimum: 0
        imageUrl:
            type: string
        createdAt:
            type: string
            format: date-time
        updatedAt:
            type: string
            format: date-time
    example:
    id: "11111111-1111-4111-8111-111111111111"
    name: "Sample Product"
    description: "Example product used in contract documentation"
    price: 19.99
    categoryId: "22222222-2222-4222-8222-222222222222"
    stock: 12
    imageUrl: "images/product1.jpg"
    createdAt: "2025-11-21T00:00:00.000Z"
    updatedAt: "2025-11-21T00:00:00.000Z"
    Category:
      type: object
      required: [id, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CategoryInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
    OrderItem:
      type: object
      required: [productId, name, price, quantity]
      properties:
        productId:
          type: string
        name:
          type: string
        price:
          type: number
        quantity:
          type: integer
          minimum: 1
    Order:
      type: object
      required: [id, items, total, status, createdAt]
      properties:
        id:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        total:
          type: number
        status:
          type: string
          enum: [submitted]
        createdAt:
          type: string
          format: date-time
    OrderInput:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId:
                type: string
              quantity:
                type: integer
                minimum: 1
