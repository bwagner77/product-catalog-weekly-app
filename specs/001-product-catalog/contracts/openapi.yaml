openapi: 3.0.3
info:
  title: Product Catalog API
  version: 1.1.0
servers:
  - url: http://localhost:3000
paths:
  /api/products:
    get:
      summary: List products
      description: Returns up to 200 products. No pagination in this phase. Supports optional text search and category filtering.
      operationId: listProducts
      parameters:
        - in: query
          name: search
          required: false
          schema:
            type: string
          description: Case-insensitive partial substring matched against name and description (multi-word treated as a single phrase).
        - in: query
          name: categoryId
          required: false
          schema:
            type: string
          description: Filter products by category id.
      responses:
        '200':
          description: OK — array of Product (max 200 items; no pagination)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '500':
          description: Server error
  /api/categories:
    get:
      summary: List categories
      operationId: listCategories
      responses:
        '200':
          description: OK — array of Category
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
    post:
      summary: Create category
      operationId: createCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryInput'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Validation error
  /api/categories/{id}:
    get:
      summary: Get category by id
      operationId: getCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          description: Not found
    put:
      summary: Update category
      operationId: updateCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryInput'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Validation error
        '404':
          description: Not found
    delete:
      summary: Delete category (blocked if products exist)
      operationId: deleteCategory
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Deleted
        '409':
          description: Conflict — category has assigned products
        '404':
          description: Not found
  /api/orders:
    post:
      summary: Submit order
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderInput'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Validation error (empty cart or invalid items)
  /api/orders/{id}:
    get:
      summary: Get order by id
      operationId: getOrder
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Not found
components:
  schemas:
    Product:
      type: object
      required: [id, name, description, price, stock, imageUrl, createdAt, updatedAt]
      properties:
        id:
            type: string
            format: uuid
        name:
            type: string
        description:
            type: string
        price:
            type: number
            format: double
        categoryId:
            type: string
            nullable: true
        stock:
            type: integer
            minimum: 0
        imageUrl:
            type: string
        createdAt:
            type: string
            format: date-time
        updatedAt:
            type: string
            format: date-time
    example:
    id: "11111111-1111-4111-8111-111111111111"
    name: "Sample Product"
    description: "Example product used in contract documentation"
    price: 19.99
    categoryId: "22222222-2222-4222-8222-222222222222"
    stock: 12
    imageUrl: "images/product1.jpg"
    createdAt: "2025-11-21T00:00:00.000Z"
    updatedAt: "2025-11-21T00:00:00.000Z"
    Category:
      type: object
      required: [id, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CategoryInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
    OrderItem:
      type: object
      required: [productId, name, price, quantity]
      properties:
        productId:
          type: string
        name:
          type: string
        price:
          type: number
        quantity:
          type: integer
          minimum: 1
    Order:
      type: object
      required: [id, items, total, status, createdAt]
      properties:
        id:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        total:
          type: number
        status:
          type: string
          enum: [submitted]
        createdAt:
          type: string
          format: date-time
    OrderInput:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId:
                type: string
              quantity:
                type: integer
                minimum: 1
